<h1>Tasks</h1>
<div class="task-creation">
  <h2>Create Task</h2>
  <form (keyup.enter)="addTask(taskName.value, taskDesc.value, taskDate.value, [taskModule.value], users, projects)">
    <label for="addTaskName">Name:</label><br />
    <input #taskName placeholder="add a task" class="lg-text-input" id="addTaskName" /><br />

    <label for="addTaskDesc">Description:</label><br />
    <input #taskDesc placeholder="add a description" class="lg-text-input" id="addTaskDesc" /><br />

    <label for="addTaskDate">Date:</label><br />
    <input #taskDate type="date" id="taskDate" /><br />

    <label for="addTaskModule">Module List:</label><br />
    <input #taskModule placeholder="add modules" class="lg-text-input" id="addTaskModule" /><br />

    <label for="addAssignedUsers">Assigned Users:</label><br />
    <select #usersSelect id="addAssignedUsers" class="lg-text-input">
      <option *ngFor="let user of users" [value]="user.emailAddress">{{ user.firstName }}</option></select
    ><br />

    <label for="addAssignedProjects">Assigned Projects:</label><br />
    <select #projectsSelect id="addAssignedProjects" class="lg-text-input">
      <option *ngFor="let project of projects" [value]="project.id">{{ project.name }}</option></select
    ><br />
  </form>

  <button
    mat-flat-button
    color="primary"
    (click)="addTask(taskName.value, taskDesc.value, taskDate.value, [taskModule.value], users, projects)"
  >
    Add Task
  </button>
</div>

<h2>
  {{ tasks.length }} <span *ngIf="tasks.length <= 1; else taskPlural">task</span>
  <ng-template #taskPlural>tasks</ng-template>
</h2>

<ul class="tasks">
  <li *ngFor="let task of tasks">
    <div class="task">
      <input [id]="task.desc" type="checkbox" (change)="task.done = !task.done" [checked]="task.done" />
      <label [for]="task.name">{{ task.name }}</label>
      <div class="desc">{{ task.desc }}</div>
      <div class="date">{{ task.date }}</div>
      <div class="modules">{{ task.modules }}</div>

      <ng-container *ngIf="task.assignedUsers">
        <div class="assignedUsers">
          <span *ngFor="let user of task.assignedUsers">
            {{ user.firstName }}
          </span>
        </div>
      </ng-container>

      <ng-container *ngIf="task.assignedProjects">
        <div class="assignedProjects">
          <span *ngFor="let project of task.assignedProjects">
            {{ project.name }}
          </span>
        </div>
      </ng-container>

      <div class="btn-wrapper" *ngIf="!editable">
        <button mat-flat-button color="accent" (click)="editable = !editable">Edit</button>
        <button mat-flat-button color="warn" (click)="deleteTask(task)">Delete</button>
      </div>

      <!-- This section shows only if user clicks Edit button -->
      <div *ngIf="editable">
        <input
          class="sm-text-input"
          placeholder="edit name"
          [value]="task.desc"
          #editedTask
          (keyup.enter)="saveTask(task, editedTask.value)"
        />

        <div class="btn-wrapper">
          <button mat-flat-button color="accent" (click)="editable = !editable">Cancel</button>
          <button mat-flat-button color="warn" (click)="saveTask(task, editedTask.value)">Save</button>
        </div>
      </div>
    </div>
  </li>
</ul>
